version: 2

sources:
  - name: account_usage
    description: >
      Contains views to query object metadata and historical usage metrics for the snowflake account.
      Account usage views include records for all objects that have been dropped. These views also have 
      some natural latency due to the process of extracting data from Snowflake's internal metadata store.
    database: snowflake
    schema: account_usage
    # list of views used as data sources in this project, arranged alphabetically
    tables:
      - name: automatic_clustering_history
        description: >
          Contains automatic clustering history including credits consumed, bytes updates, and rows updated 
          each time a table is reclustered. Data latency for this view may be up to 180 minutes (3 hours).
        columns:
          - name: start_time
            description: Start of the specified time range.
          - name: end_time
            description: End of the specified time range.
          - name: credits_used
            description: Number of credits billed for automatic clustering during the start_time and end_time window.
          - name: num_bytes_reclustered
            description: Number of bytes reclustered during the start_time and end_time window.
          - name: num_rows_reclustered
            description: Number of rows reclustered during the start_time and end_time window.
          - name: table_id
            description: Internal/system-generated identifier for the table.
          - name: table_name
            description: Name of the table.
          - name: schema_id
            description: Internal/system-generated identifier for the schema that contains the table.
          - name: schema_name
            description: Name of the schema that contains the table.
          - name: database_id
            description: Internal/system-generated identifier for the database that contains the table.
          - name: database_name
            description: Name of the database that contains the table.

      - name: database_replication_usage_history
        description: >
          Contains database replication history including the database name, credits consumed, and bytes transferred 
          for replication. Usage data is retained for 365 days (1 year). Data latency may be up to 180 minutes (3 hours).
        columns:
          - name: start_time
            description: The date and beginning of the hour (in the local time zone) in which the replication usage took place.
          - name: end_time
            description: The date and end of the hour (in the local time zone) in which the replication usage took place.
          - name: database_name
            description: Name of the database.
          - name: database_id
            description: Internal/system-generated identifier for the database.
          - name: credits_used
            description: Total number of credits used for database replication during the start_time and end_time window.
          - name: bytes_transferred
            description: Number of bytes transferred for database replication during the start_time and end_time window.

      - name: materialized_view_refresh_history
        description: >
          Contains materialized view refresh history including view name and credits consumed each time a materialized view 
          is refreshed. Data latency may be up to 180 minutes (3 hours). The history is displayed in increments of 1 hour.
        columns:
          - name: start_time
            description: Start of the specified time range.
          - name: end_time
            description: End of the specified time range.
          - name: credits_used
            description: Number of credits billed for materialized view maintenance during the start_time and end_time window.
          - name: table_id
            description: Internal/system-generated identifier for the materialized view.
          - name: table_name
            description: Name of the materialized view.
          - name: schema_id
            description: Internal/system-generated identifier for the schema that contains the materialized view.
          - name: schema_name
            description: Name of the schema that contains the materialized view.
          - name: database_id
            description: Internal/system-generated identifier for the database that contains the materialized view.
          - name: database_name
            description: Name of the database that contains the materialized view.

      - name: query_acceleration_history
        description: >
          Contains the history of queries accelerated by the query acceleration service, including warehouse name and the
          credits consumed by the query acceleration service. Data latency may be up to 180 minutes (3 hours).
        columns:
          - name: start_time
            description: Start of the specified time range.
          - name: end_time
            description: End of the specified time range.
          - name: credits_used
            description: Number of credits billed for the query acceleration service during the start_time and end_time window.
          - name: warehouse_id
            description: Internal/system-generated identifier for the warehouse.
          - name: warehouse_name
            description: Name of the warehouse.

      - name: query_history
        description: >
          Contains Snowflake query history by various dimensions (time range, session, user, warehouse, etc.) within the last 365 days (1 year).
          Latency for the view may be up to 45 minutes.
        columns:
          - name: reader_account_name
            description: Name of the reader account in which the SQL statement was executed.
          - name: query_id
            description: Internal/system-generated identifier for the SQL statement.
          - name: query_text
            description: Text of the SQL statement. Limit is 100K characters. SQL statements containing more than 100K characters will be truncated.
          - name: database_id
            description: Internal/system-generated identifier for the database that was in use.
          - name: database_name
            description: Database that was in use at the time of the query.
          - name: schema_id
            description: Internal/system-generated identifier for the schema that was in use.
          - name: schema_name
            description: Schema that was in use at the time of the query.
          - name: query_type
            description: DML, query, etc. If the query failed, then the query type may be UNKNOWN.
          - name: session_id
            description: Session that executed the statement.
          - name: user_name
            description: User who issued the query.
          - name: role_name
            description: Role that was active in the session at the time of the query.
          - name: warehouse_id
            description: Internal/system-generated identifier for the warehouse that was used.
          - name: warehouse_name
            description: Warehouse that the query executed on, if any.
          - name: warehouse_size
            description: Size of the warehouse when this statement executed.
          - name: warehouse_type
            description: Type of the warehouse when this statement executed.
          - name: cluster_number
            description: The cluster (in a multi-cluster warehouse) that this statement executed on.
          - name: query_tag
            description: Query tag set for this statement through the QUERY_TAG session parameter.
          - name: execution_status
            description: Execution status for the query. Valid values are success, fail, incident.
          - name: error_code
            description: Error code, if the query returned an error
          - name: error_message
            description: Error message, if the query returned an error
          - name: start_time
            description: Statement start time (in the UTC time zone)
          - name: end_time
            description: Statement end time (in the UTC time zone).
          - name: total_elapsed_time
            description: Elapsed time (in milliseconds).
          - name: bytes_scanned
            description: Number of bytes scanned by this statement.
          - name: percentage_scanned_from_cache
            description: >
              The percentage of data scanned from the local disk cache. The value ranges from 0.0 to 1.0. Multiply by 100 to get a true percentage.
          - name: bytes_written
            description: Number of bytes written (e.g. when loading into a table).
          - name: bytes_written_to_result
            description: >
              Number of bytes written to a result object. For example, select * from . . . would produce a set of results in tabular format 
              representing each field in the selection. In general, the results object represents whatever is produced as a result of the query, 
              and BYTES_WRITTEN_TO_RESULT represents the size of the returned result.
          - name: bytes_read_from_result
            description: Number of bytes read from a result object.
          - name: rows_produced
            description: Number of rows produced by this statement.
          - name: rows_inserted
            description: Number of rows inserted by the query.
          - name: rows_updated
            description: Number of rows updated by the query.
          - name: rows_deleted
            description: Number of rows deleted by the query.
          - name: rows_unloaded
            description: Number of rows unloaded during data export.
          - name: bytes_deleted
            description: Number of bytes deleted by the query.
          - name: partitions_scanned
            description: Number of micro-partitions scanned.
          - name: partitions_total
            description: Total micro-partitions of all tables included in this query.
          - name: bytes_spilled_to_local_storage
            description: Volume of data spilled to local disk.
          - name: bytes_spilled_to_remote_storage
            description: Volume of data spilled to remote disk.
          - name: bytes_sent_over_the_network
            description: Volume of data sent over the network.
          - name: compilation_time
            description: Compilation time (in milliseconds)
          - name: execution_time
            description: Execution time (in milliseconds)
          - name: queued_provisioning_time
            description: >
              Time (in milliseconds) spent in the warehouse queue, waiting for the warehouse compute resources to provision, 
              due to warehouse creation, resume, or resize.
          - name: queued_repair_time
            description: Time (in milliseconds) spent in the warehouse queue, waiting for compute resources in the warehouse to be repaired.
          - name: queued_overload_time
            description: Time (in milliseconds) spent in the warehouse queue, due to the warehouse being overloaded by the current query workload.
          - name: transaction_blocked_time
            description: Time (in milliseconds) spent blocked by a concurrent DML.
          - name: outbound_data_transfer_cloud
            description: Target cloud provider for statements that unload data to another region and/or cloud.
          - name: outbound_data_transfer_region
            description: Target region for statements that unload data to another region and/or cloud.
          - name: outbound_data_transfer_bytes
            description: Number of bytes transferred in statements that unload data to another region and/or cloud.
          - name: inbound_data_transfer_cloud
            description: Source cloud provider for statements that load data from another region and/or cloud.
          - name: inbound_data_transfer_region
            description: Source region for statements that load data from another region and/or cloud.
          - name: inbound_data_transfer_bytes
            description: Number of bytes transferred in statements that load data from another region and/or cloud.
          - name: list_external_files_time
            description: Time (in milliseconds) spent listing external files.
          - name: credits_used_cloud_services
            description: Number of credits used for cloud services.
          - name: release_version
            description: Release version in the format of major_release.minor_release.patch_release.
          - name: external_function_total_invocations
            description: The aggregate number of times that this query called remote services. For important details, see the Usage Notes.
          - name: external_function_total_sent_rows
            description: The total number of rows that this query sent in all calls to all remote services.
          - name: external_function_total_received_rows
            description: The total number of rows that this query received from all calls to all remote services.
          - name: external_function_total_sent_bytes
            description: The total number of bytes that this query sent in all calls to all remote services.
          - name: external_function_total_received_bytes
            description: The total number of bytes that this query received from all calls to all remote services.
          - name: query_load_percent
            description: The approximate percentage of active compute resources in the warehouse for this query execution.
          - name: is_client_generated_statement
            description: Indicates whether the query was client-generated.
          - name: query_acceleration_bytes_scanned
            description: Number of bytes scanned by the query acceleration service.
          - name: query_acceleration_partitions_scanned
            description: Number of partitions scanned by the query acceleration service.
          - name: query_acceleration_upper_limit_scale_factor
            description: Upper limit scale factor that a query would have benefited from.
          - name: child_queries_wait_time
            description: Time (in milliseconds) to complete the cached lookup when calling a memoizable function.
          - name: owner
            description: The name of the role that owns the role that was active in the session at the time of the query.
          - name: owner_role_type
            description: >
              The type of role that owns the object, either ROLE or DATABASE_ROLE. Note that Snowflake returns NULL if you delete the object 
              because there is no owner role for a deleted object.
          - name: transaction_id
            description: ID of the transaction that contains the statement or 0 if the statement is not executed within a transaction.
          - name: role_type
            description: Specifies whether a ROLE or DATABASE_ROLE executed the query.
          - name: query_hash
            description: The hash value computed based on the canonicalized SQL text.
          - name: query_hash_version
            description: The version of the logic used to compute QUERY_HASH.
          - name: query_parameterized_hash
            description: The hash value computed based on the parameterized query.
          - name: query_parameterized_hash_version
            description: The version of the logic used to compute QUERY_PARAMETERIZED_HASH.

      - name: search_optimization_history
        description: >
          Contains the search optimization history including the service name and credits consumed by the service. Data 
          latency may be up to 180 minutes (3 hours).
        columns:
          - name: start_time
            description: Start of the specified time range.
          - name: end_time
            description: End of the specified time range.
          - name: credits_used
            description: Number of credits billed for the search optimization service during the start_time and end_time window.
          - name: table_id
            description: Internal/system-generated identifier for the search optimization service.
          - name: table_name
            description: >
              This is a system-generated alias that contains the ID of the table for which search optimization was enabled; that 
              ID is embedded inside a string of the form "SEARCH OPTIMIZATION ON TABLE_ID: <optimized_table_id>". For example, 
              if you enable search optimization on a table named accounts, and if accounts has ID 1200, then the TABLE_NAME
              (alias) shown in this column will be "SEARCH OPTIMIZATION ON TABLE_ID: 1200".
          - name: schema_id
            description: Internal/system-generated identifier for the schema that contains the search optimization service.
          - name: schema_name
            description: Name of the schema that contains the search optimization service.
          - name: database_id
            description: Internal/system-generated identifier for the database that contains the search optimization service.
          - name: database_name
            description: Name of the database that contains the search optimization service.

      - name: serverless_task_history
        description: >
          Contains the serverless task usage history including the task name and credits consumed by serverless task usage. 
          Data latency may be up to 180 minutes (3 hours).
        columns:
          - name: start_time
            description: Start of the specified time range.
          - name: end_time
            description: End of the specified time range.
          - name: credits_used
            description: Number of credits billed for serverless task usage during the start_time and end_time window.
          - name: task_id
            description: Internal/system-generated identifier for the serverless task.
          - name: task_name
            description: Name of the serverless task.
          - name: schema_id
            description: Internal/system-generated identifier for the schema that contains the serverless task.
          - name: schema_name
            description: Name of the schema that contains the serverless task.
          - name: database_id
            description: Internal/system-generated identifier for the database that contains the serverless task.
          - name: database_name
            description: Name of the database that contains the serverless task.

      - name: snowpipe_streaming_file_migration_history
        description: >
          Contains the history od data migrated into Snowflake tables using Snowpipe streaming within the last 365 days (1 year).
          It includes the number of rows and bytes migrated, and credits used for migration. Data latency may be up to 12 hours.
        columns:
          - name: start_time
            description: Start of the time (in the local time zone) range in which data migration took place.
          - name: end_time
            description: End of the time (in the local time zone) range in which data migration took place.
          - name: credits_used
            description: Number of credits billed for Snowpipe Streaming data migration during the start_time and end_time window.
          - name: num_bytes_migrated
            description: Number of bytes migrated during the start_time and end_time window.
          - name: num_rows_migrated
            description: Number of rows migrated during the start_time and end_time window.
          - name: table_id
            description: Internal/system-generated identifier for the target table of the Snowpipe Streaming client.
          - name: table_name
            description: The name of the target table that the Snowpipe Streaming client loads data into.
          - name: schema_id
            description: Internal/system-generated identifier for the schema that the target table belongs to.
          - name: schema_name
            description: The name of the schema that the target table belongs to.
          - name: database_id
            description: Internal/system-generated identifier for the database that the target table belongs to.
          - name: database_name
            description: The name of the database that the target table belongs to.

      - name: table_storage_metrics
        description: >
          Contains table-level storage utilization information which is used to calculate the storage billing.
          Data latency may be up to 90 minutes.
        columns:
          - name: id
            description: Internal/system-generated identifier for the table.
          - name: table_name
            description: Name of the table.
          - name: table_schema_id
            description: Internal/system-generated identifier for the schema of the table.
          - name: table_schema
            description: Schema that the table belongs to.
          - name: table_catalog_id
            description: Internal/system-generated identifier for the database of the table.
          - name: table_catalog
            description: Database that the table belongs to.
          - name: clone_group_id
            description: Unique identifier for the oldest clone ancestor of this table. Same as ID if the table is not a clone.
          - name: is_transient
            description: YES if table is transient or temporary, otherwise NO. Transient and temporary tables have no fail-safe period.
          - name: active_bytes
            description: Bytes owned by (and billed to) this table that are in the active state for the table.
          - name: time_travel_bytes
            description: Bytes owned by (and billed to) this table that are in the time travel state for the table.
          - name: failsafe_bytes
            description: Bytes owned by (and billed to) this table that are in the fail-safe state for the table.
          - name: retained_for_clone_bytes
            description: Bytes owned by (and billed to) this table that are retained after deletion because of one or more clones of this table.
          - name: deleted
            description: TRUE if table has been purged from storage.
          - name: table_created
            description: Date and time when the table was created.
          - name: table_dropped
            description: Date and time when the table was dropped. NULL if table has not been dropped.
          - name: table_entered_failsafe
            description: Date and time when the table, if dropped, entered the fail-safe state, or NULL. In this state, table cannot be restored using UNDROP.
          - name: schema_created
            description: Date and time when the schema for the table was created.
          - name: schema_dropped
            description: Date and time when the schema for the table was dropped.
          - name: catalog_created
            description: Date and time when the database for the table was created.
          - name: catalog_dropped
            description: Date and time when the database for the table was dropped.
          - name: comment
            description: Comment for the table.

      - name: tables
        description: Contains a row for each table and view in the snowflake account. Data latency may be up to 90 minutes.
        columns:
          - name: table_id
            description: Internal, Snowflake-generated identifier for the table.
          - name: table_name
            description: Name of the table.
          - name: table_schema_id
            description: Internal, Snowflake-generated identifier of the schema for the table.
          - name: table_schema
            description: Schema that the table belongs to.
          - name: table_catalog_id
            description: Internal, Snowflake-generated identifier of the database for the table.
          - name: table_catalog
            description: Database that the table belongs to.
          - name: table_owner
            description: Name of the role that owns the table.
          - name: table_type
            description: Whether the table is a base table or view.
          - name: is_transient
            description: Whether the table is transient.
          - name: clustering_key
            description: Column(s) and/or expression(s) that comprise the clustering key for the table.
          - name: row_count
            description: Number of rows in the table.
          - name: bytes
            description: Number of bytes accessed by a scan of the table.
          - name: retention_time
            description: Number of days that historical data is retained for Time Travel.
          - name: self_referencing_column_name
            description: Not applicable for Snowflake.
          - name: reference_generation
            description: Not applicable for Snowflake.
          - name: user_defined_type_catalog
            description: Not applicable for Snowflake.
          - name: user_defined_type_schema
            description: Not applicable for Snowflake.
          - name: user_defined_type_name
            description: Not applicable for Snowflake.
          - name: is_insertable_into
            description: Not applicable for Snowflake.
          - name: is_typed
            description: Not applicable for Snowflake.
          - name: commit_action
            description: Not applicable for Snowflake.
          - name: created
            description: Date and time when the table was created.
          - name: last_altered
            description: Date and time when the table was last altered by a DDL or DML operation.
          - name: last_ddl
            description: Timestamp of the last DDL operation performed on the table or view, including database refreshes for replication.
          - name: last_ddl_by
            description: Username of the user who performed the last DDL operation on the table or view.
          - name: deleted
            description: Date and time when the table was dropped.
          - name: comment
            description: Comment for the table.
          - name: owner_role_type
            description: The type of role that owns the object, either ROLE or DATABASE_ROLE or NULL for deleted object.

      - name: tag_references
        description: Contains associations between objects and tags. Data latency may be up to 120 minutes (2 hours).
        columns:
          - name: tag_database
            description: The database in which the tag is set.
          - name: tag_schema
            description: The schema in which the tag is set.
          - name: tag_id
            description: Internal/system-generated identifier for the tag. Note that for system tags this value is NULL.
          - name: tag_name
            description: The name of the tag. This is the key in the key = value pair of the tag.
          - name: tag_value
            description: The value of tag. This is the value in the key = value pair of the tag.
          - name: object_database
            description: Database name of the referenced object for database and schema objects. Empty if the object is not a database or schema object.
          - name: object_schema
            description: Schema name of the referenced object (for schema objects). Empty if the referenced object is not a schema object.
          - name: object_id
            description: Internal identifier of the referenced object.
          - name: object_name
            description: Name of the referenced object if the tag association is on the object. If the tag association is on a column, Snowflake returns the parent table name.
          - name: object_deleted
            description: Date and time when the associated object was dropped, or if the parent object is dropped.
          - name: domain
            description: Domain of the reference object (e.g. table, view) if the tag association is on the object.
          - name: column_id
            description: The local identifier of the reference column; not applicable if the tag association is not a column.
          - name: column_name
            description: Name of the referenced column; not applicable if the tag association is not a column.

      - name: warehouse_metering_history
        description: >
          Contains hourly credit usage for all warehouses within the last 365 days (1 year). Data Latency may be 
          up to 180 minutes (3 hours), except for the CREDITS_USED_CLOUD_SERVICES column (up to 6 hours).
        columns:
          - name: reader_account_name
            description: Name of the reader account where the warehouse usage took place.
          - name: start_time
            description: The date and beginning of the hour (in the local time zone) in which the warehouse usage took place.
          - name: end_time
            description: The date and end of the hour (in the local time zone) in which the warehouse usage took place.
          - name: warehouse_id
            description: Internal/system-generated identifier for the warehouse.
          - name: warehouse_name
            description: Name of the warehouse.
          - name: credits_used
            description: >
              Total number of credits used for the warehouse in the hour. This is a sum of CREDITS_USED_COMPUTE and CREDITS_USED_CLOUD_SERVICES. 
              It does not take into account the adjustment for cloud services, and may therefore be greater than your actual credit consumption.
          - name: credits_used_compute
            description: Number of credits used for the warehouse in the hour.
          - name: credits_used_cloud_services
            description: Number of credits used for cloud services in the hour.

  - name: old_billing
    description: >
      Contains the enterprise data lake's legacy billing configuration tables. Data in these old billing 
      configuration tables is included in the project so that historical data is preserved.
    database: edl_audit
    schema: billing
    # list of tables used as data sources in this project, arranged alphabetically
    tables:
      - name: edl_project
        description: Contains all projects that use the enterprise data lake with billing information.
        columns:
          - name: project_id
            description: System-generated unique identifier for the project.
          - name: project_name
            description: Name of the project as provided by the workspace owner in the SARA request form.
          - name: project_description
            description: Brief description of the project from the SARA request form.
          - name: customer_name
            description: Name of the health entity who owns the project.
          - name: cost_center
            description: Cost center code to which the incurred costs are charged back to.
          - name: otl_code
            description: Oracle time and labour code to which the incurred costs are charged back to.
          - name: otl_task
            description: Oracle time and labour task code to which the incurred costs are charged back to.
          - name: contact_info_id
            description: Obsolete column, not used.
          - name: bill_flag
            description: Indicates if the incurred costs are charged back ('True') or not ('False').
          - name: valid_from
            description: The start date and time (in the local time zone) of the project.
          - name: valid_to
            description: The end date and time (in the local time zone) of the project.
          - name: project_code
            description: Unique short abbreviated code of the project.
          - name: role_name
            description: Obsolete column, not used.

      - name: edl_subscription
        description: Contains all workspaces that use the enterprise data lake with reference keys to project.
        columns:
          - name: subscription_id
            description: System-generated unique identifier for the subscription record.
          - name: project_id
            description: Foreign key to edl_project table.
          - name: table_hash
            description: Foreign key to edl_tables table.
          - name: description
            description: Description of the subscription record. Usually contains the fully qualified name of the subscribed table.
          - name: requested_freq
            description: Minutes between two successive scheduled data refreshes.
          - name: realtime_flag
            description: Indicates if the table subscription frequency is realtime (true) or not (false).
          - name: valid_from
            description: The start date and time (in the local time zone) of the subscription.
          - name: valid_to
            description: The end date and time (in the local time zone) of the subscription.

      - name: edl_tables
        description: Contains all workspaces that use the enterprise data lake with reference keys to project.
        columns:
          - name: table_hash
            description: Unique identifier for the subscribed table, generated using md5.
          - name: system_name
            description: Name of the source system. E.g. CERNER
          - name: instance_name
            description: Name of the source system instance. E.g. GSGW
          - name: schema_name
            description: Name of the source system's database schema. E.g. V500
          - name: table_name
            description: Name of the source system table. E.g. ENCOUNTER
          - name: base_frequency
            description: Default minutes between two successive scheduled data refreshes. This can vary for each subscription.
          - name: custom_cron
            description: Default cron expression of the scheduled data refresh frequency.
          - name: valid_from
            description: The date and time (in the local time zone) when the table was first active into the data lake.
          - name: valid_to
            description: The date and time (in the local time zone) when the table was last active in the data lake.

      - name: edl_workspace
        description: Contains all workspaces that use the enterprise data lake with reference keys to project.
        columns:
          - name: workspace_id
            description: System-generated unique identifier for the workspace.
          - name: project_id
            description: Foreign key to edl_project table.
          - name: workspace_name
            description: Name of the workspace as provided by the workspace owner in the SARA request form.
          - name: description
            description: Brief description of the workspace from the SARA request form.
          - name: valid_from
            description: The start date and time (in the local time zone) of the project.
          - name: valid_to
            description: The end date and time (in the local time zone) of the project.
